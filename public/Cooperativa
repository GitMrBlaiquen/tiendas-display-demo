/* Oculta el select nativo (pero lo deja en el DOM para que tu JS siga funcionando) */
.native-select-hidden{
  position: absolute !important;
  opacity: 0 !important;
  pointer-events: none !important;
  width: 1px !important;
  height: 1px !important;
  margin: 0 !important;
  padding: 0 !important;
}


function makeCustomSelect(selectId, { iconSrc = "" } = {}) {
  const original = document.getElementById(selectId);
  if (!original) return;

  // Evita duplicados
  if (original.dataset.customReady === "1") return;
  original.dataset.customReady = "1";

  // Ocultar select nativo de forma segura
  original.classList.add("native-select-hidden");

  // Wrapper
  const wrapper = document.createElement("div");
  wrapper.className = "custom-select";

  const display = document.createElement("div");
  display.className = "custom-select-display";

  // (Opcional) ícono
  if (iconSrc) {
    const ico = document.createElement("img");
    ico.src = iconSrc;
    ico.alt = "";
    ico.style.width = "18px";
    ico.style.height = "18px";
    ico.style.objectFit = "contain";
    ico.style.marginRight = "10px";
    ico.style.verticalAlign = "middle";
    display.appendChild(ico);
  }

  const txt = document.createElement("span");
  txt.textContent = original.options[original.selectedIndex]?.text || "Seleccionar";
  display.appendChild(txt);

  const optionsBox = document.createElement("div");
  optionsBox.className = "custom-select-options";

  function rebuildOptions() {
    optionsBox.innerHTML = "";
    Array.from(original.options).forEach((opt) => {
      const item = document.createElement("div");
      item.textContent = opt.text;

      item.addEventListener("click", () => {
        original.value = opt.value;
        txt.textContent = opt.text;
        optionsBox.style.display = "none";
        original.dispatchEvent(new Event("change", { bubbles: true }));
      });

      optionsBox.appendChild(item);
    });

    // refresca texto por si cambia el selectedIndex
    txt.textContent = original.options[original.selectedIndex]?.text || "Seleccionar";
  }

  display.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    optionsBox.style.display = optionsBox.style.display === "block" ? "none" : "block";
  });

  document.addEventListener("click", () => {
    optionsBox.style.display = "none";
  });

  wrapper.appendChild(display);
  wrapper.appendChild(optionsBox);

  // Insertar justo después del select
  original.parentNode.insertBefore(wrapper, original.nextSibling);

  rebuildOptions();

  // Si tu app rellena opciones después (login, cambio cliente, etc)
  const obs = new MutationObserver(() => rebuildOptions());
  obs.observe(original, { childList: true });
}